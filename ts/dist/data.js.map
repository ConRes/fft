{"version":3,"file":"data.js","sources":["../src/data.ts"],"sourcesContent":["/// <reference path='./types/types.d.ts' />\n\nabstract class AbstractData<D extends DataLike<T>, T> implements Partial<Data<T>> {\n    get<U = T>(this: D, i: number): U { return this[i]; }\n    set<U = T>(this: D, i: number, value: U | T) { this[i] = value; }\n}\n\nexport const getSuperConstructor = <T extends S, S extends TypedConstructor>(Type: T, ...args: any[]): S => Object.getPrototypeOf(Object.getPrototypeOf(new Type(...args.length ? args : [1])).constructor);\nexport const TypedArray = getSuperConstructor(Uint8Array) as TypedArrayConstructor;\nexport const stringTag = (object: any): string => Object.prototype.toString.call(object);\n\nabstract class TypedArrayData<D extends DataLike<T>, T> extends AbstractData<D, T> implements Partial<Data<T>> {\n    get<U = T>(this: D, i: number): U { return this[i]; }\n    set<U = T>(this: D, i: number, value: U) { this[i] = value; }\n    // set<U = T>(this: D, i: number, value: U) { (this.constructor.prototype as TypedArray).set.call(this, [value] as any, i); }\n    // set<U = T>(this: D, i: number, value: U) { (super.set as any).call(this, [value] as any, i); }\n    // set<U = T>(this: D, i: number, value: U) { this['_set'].call(this, [value], i); } // (this.constructor.prototype as TypedArray).set.call(this, value as any, i); }\n    // set<U = T>(this: D, i: number, value: U) { this['_set'].call(this, [value], i); } // (this.constructor.prototype as TypedArray).set.call(this, value as any, i); }\n}\n\nconst [writable, configurable] = [true, true];\n\nconst abstractDataDescriptors = {\n    get: { writable, value: AbstractData.prototype.get },\n    set: { writable, value: AbstractData.prototype.set },\n};\n\nconst typedArrayDataDescriptors = {\n    get: { writable, value: TypedArrayData.prototype.get },\n    set: { writable, value: TypedArrayData.prototype.set },\n};\n\nconst IS_DATA_OBJECT = Symbol('[[IS_DATA_OBJECT]]');\n\nexport function initialize<D extends DataLike<T>, T>(data: D) { // : D & Data<T> {\n    if (!data || typeof data !== 'object') throw ReferenceError(`Cannot initialize data from ${/^[aeiou]/.test(typeof data) ? 'an' : 'a'} ${typeof data} value!`);\n    if (data[IS_DATA_OBJECT] = data[IS_DATA_OBJECT] || 'get' in data && 'set' in data && typeof data['get'] === 'function' && typeof data['set'] === 'function') {\n        // assuming previously initialized or compatible type\n    } else if (typeof data['get'] === 'function' && typeof data['set'] === 'function') {\n        console.warn(`Blocked an attempt to initialize data from an object that defines both get and set methods to avoid potential conflicts with non-data-related implementations!`);\n    } else {\n        if (data instanceof TypedArray) {\n            // data['_set'] = data.set;\n            Object.defineProperties(data, typedArrayDataDescriptors);\n        } else if (Array.isArray(data)) {\n            data['get'] = AbstractData.prototype.get; // .bind(data);\n            data['set'] = AbstractData.prototype.set; // .bind(data);\n        } else throw TypeError(`Cannot initialize data from ${stringTag(data)} instance!`);\n        data[IS_DATA_OBJECT] = true;\n    }\n\n    return data as D & Data<T>;\n}\n\nexport default initialize;\n"],"names":[],"mappings":"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"}